---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";

// ðŸ”¹ Gera as rotas estÃ¡ticas com base nas categorias existentes
export async function getStaticPaths() {
  const posts = await getCollection("blog");
  let categories = [
    ...new Set(
      posts
        .map(p => p.data.category)
        .filter(Boolean)
        .map(c => c.trim().toLowerCase().replace(/\s+/g, "-"))
    ),
  ];

  // ðŸ”¸ Se nÃ£o houver categorias, cria uma padrÃ£o
  if (categories.length === 0) {
    categories = ["blog"];
  }

  return categories.map(category => ({
    params: { category },
  }));
}

// ðŸ”¹ ObtÃ©m a categoria da URL
const { category } = Astro.params;

// ðŸ”¹ Carrega e filtra os posts dessa categoria (ou mostra todos se for "blog")
const posts = await getCollection("blog");
const filtered =
  category === "blog"
    ? posts
    : posts.filter(
        p =>
          p.data.category &&
          p.data.category.toLowerCase().replace(/\s+/g, "-") === category
      );

// ðŸ”¹ Idiomas suportados
const labels = {
  en: { title: "Category", none: "No posts in this category." },
  es: { title: "CategorÃ­a", none: "No hay publicaciones en esta categorÃ­a." },
  pt: { title: "Categoria", none: "Nenhum post nesta categoria." },
};

const lang = "pt"; // "en", "es" ou "pt"
const L = labels[lang] || labels.en;
const title = `${L.title}: ${category}`;
---

<Base title={title}>
  <section style="padding: 2rem;">
    <h1 style="text-align:center;">{title}</h1>

    {filtered.length === 0 ? (
      <p style="text-align:center;">{L.none}</p>
    ) : (
      <ul
        style="
          list-style:none;
          display:grid;
          gap:1rem;
          max-width:600px;
          margin:2rem auto;
        "
      >
        {filtered.map(post => (
          <li>
            <a
              href={`/blog/${post.slug}/`}
              style="text-decoration:none;color:var(--accent);font-weight:600;"
            >
              {post.data.title}
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</Base>
